<style>
/* Modal - seguindo padrão admin-home */
/* Resetar estilos que podem vazar de outros modais */
.point-details-modal .progress-wrapper,
.point-details-modal .progress-bar-mini,
.point-details-modal .progress-fill,
.point-details-modal .progress-text {
    display: none !important;
}

.point-details-modal .modal-dialog {
    width: 900px;
    max-width: 90vw;
    margin: 30px auto;
}

.point-details-modal .modal-content {
    border: none;
    border-radius: 0;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
}

.point-details-modal .modal-header {
    background: #fff;
    border-bottom: 1px solid #f0f0f0;
    padding: 2rem 3rem;
    position: relative;
}

.point-details-modal .modal-title {
    font-size: 2rem;
    font-weight: 300;
    color: #333;
    margin: 0;
}

.point-details-modal .modal-header .close {
    position: absolute;
    right: 2rem;
    top: 50%;
    transform: translateY(-50%);
    font-size: 2rem;
    font-weight: 300;
    opacity: 0.6;
    transition: opacity 0.2s;
    border: none;
    background: none;
    padding: 0.5rem;
    line-height: 1;
    width: auto;
    height: auto;
}

.point-details-modal .modal-header .close:hover {
    opacity: 1;
}

.point-details-modal .modal-body {
    padding: 0;
    background: #fafafa;
    max-height: calc(100vh - 200px);
    overflow-y: auto;
    overflow-x: hidden;
}

.point-details-modal .modal-footer {
    background: #fff;
    border-top: 1px solid #f0f0f0;
    padding: 2rem 3rem;
    display: flex;
    justify-content: flex-end;
    gap: 1rem;
}

/* Seções de conteúdo */
.detail-section {
    background: #fff;
    border-bottom: 1px solid #f0f0f0;
    padding: 2rem 2.5rem;
}

.detail-section:last-child {
    border-bottom: none;
}

.section-title {
    font-size: 1.5rem;
    font-weight: 400;
    color: #333;
    margin: 0 0 1.5rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

/* Grid de informações */
.info-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 2rem;
}

.info-group {
    display: flex;
    flex-direction: column;
    gap: 1.25rem;
}

.info-row {
    display: flex;
    gap: 1rem;
    align-items: baseline;
    margin-bottom: 0.25rem;
}

.info-label {
    font-size: 1.125rem;
    color: #666;
    min-width: 140px;
}

.info-value {
    font-size: 1.125rem;
    color: #333;
    font-weight: 400;
}

.info-value.monospace {
    font-family: monospace;
    font-size: 1.25rem;
}

/* Cards de estatísticas */
.stats-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 1rem;
}

.stat-card-mini {
    background: #fafafa;
    border: 1px solid #f0f0f0;
    padding: 2rem 1.5rem;
    text-align: center;
    transition: all 0.2s;
}

.stat-card-mini:hover {
    background: #fff;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    transform: translateY(-1px);
}

.stat-card-mini .value {
    font-size: 2.5rem;
    font-weight: 300;
    color: #333;
    margin-bottom: 0.5rem;
}

.stat-card-mini .label {
    font-size: 1rem;
    color: #666;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

/* Badges */
.badge {
    display: inline-flex;
    align-items: center;
    padding: 0.375rem 0.875rem;
    font-size: 1rem;
    font-weight: 500;
    border: 1px solid;
}

.badge-success {
    background: #f0fdf4;
    color: #15803d;
    border-color: #bbf7d0;
}

.badge-warning {
    background: #fffbeb;
    color: #b45309;
    border-color: #fed7aa;
}

.badge-default {
    background: #fafafa;
    color: #6b7280;
    border-color: #e5e7eb;
}

/* Tabela de inspeções */
.inspections-table {
    width: 100%;
    border-collapse: collapse;
}

.inspections-table thead tr {
    border-bottom: 1px solid #f0f0f0;
}

.inspections-table th {
    padding: 1rem 1.25rem;
    text-align: left;
    font-weight: 400;
    color: #666;
    font-size: 1rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.inspections-table tbody tr {
    border-bottom: 1px solid #fafafa;
}

.inspections-table tbody tr:hover {
    background-color: #fafafa;
}

.inspections-table td {
    padding: 1rem 1.25rem;
    font-size: 1.125rem;
    color: #333;
}

/* Classes badges */
.class-tags {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
}

.class-tag {
    background: #f0f0f0;
    border: 1px solid #e5e5e5;
    padding: 0.25rem 0.625rem;
    font-size: 1rem;
    color: #666;
}

/* Botões de ação */
.btn-sm {
    padding: 0.375rem 0.75rem;
    border: 1px solid #e5e5e5;
    background: #fff;
    font-size: 1rem;
    cursor: pointer;
    transition: all 0.15s;
    margin: 0 0.25rem;
}

.btn-sm:hover {
    background: #fafafa;
    border-color: #333;
}

.btn-sm.btn-warning {
    color: #b45309;
}

.btn-sm.btn-danger {
    color: #dc2626;
}

/* Estado vazio */
.empty-message {
    text-align: center;
    padding: 3rem;
    color: #666;
    font-size: 1.125rem;
}

.empty-message i {
    font-size: 3rem;
    color: #e5e5e5;
    margin-bottom: 1rem;
    display: block;
}

/* Botões footer */
.btn {
    padding: 0.75rem 1.5rem;
    border: 1px solid #e5e5e5;
    background: #fff;
    font-size: 1rem;
    cursor: pointer;
    transition: all 0.15s;
}

.btn:hover {
    background: #fafafa;
    border-color: #d4d4d4;
}

.btn-primary {
    background: #333;
    color: #fff;
    border-color: #333;
    font-weight: 400;
}

.btn-primary:hover {
    background: #111;
    border-color: #111;
}

/* Responsividade */
@media (max-width: 768px) {
    .point-details-modal .modal-dialog {
        width: 100vw;
        margin: 0;
        height: 100vh;
    }
    
    .point-details-modal .modal-content {
        height: 100vh;
        display: flex;
        flex-direction: column;
    }
    
    .point-details-modal .modal-body {
        max-height: calc(100vh - 140px);
    }
    
    .info-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
    }
    
    .stats-cards {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .point-details-modal .modal-title {
        font-size: 1.5rem;
    }
    
    .stat-card-mini .value {
        font-size: 2rem;
    }
    
    .detail-section {
        padding: 1.5rem 1.5rem;
    }
    
    .info-label {
        min-width: 120px;
    }
}
</style>

<div class="modal-header">
    <h3 class="modal-title">
        Detalhes do Ponto: {{ point._id }}
    </h3>
    <button type="button" class="close" ng-click="close()" aria-label="Fechar">
        <span aria-hidden="true">&times;</span>
    </button>
</div>

<div class="modal-body">
    <!-- Informações de Localização -->
    <div class="detail-section">
        <h4 class="section-title">Informações de Localização</h4>
        <div class="info-grid">
            <div class="info-group">
                <div class="info-row">
                    <span class="info-label">ID:</span>
                    <span class="info-value">{{ point._id }}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Latitude:</span>
                    <span class="info-value monospace">{{ point.lat | number:6 }}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Longitude:</span>
                    <span class="info-value monospace">{{ point.lon | number:6 }}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Bioma:</span>
                    <span class="info-value">{{ point.biome || 'N/A' }}</span>
                </div>
            </div>
            <div class="info-group">
                <div class="info-row">
                    <span class="info-label">Estado (UF):</span>
                    <span class="info-value">{{ point.uf || 'N/A' }}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Município:</span>
                    <span class="info-value">{{ point.county || 'N/A' }}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Código:</span>
                    <span class="info-value">{{ point.countyCode || 'N/A' }}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Status:</span>
                    <span ng-if="getInspectionCount() >= campaign.numInspec" class="badge badge-success">Completo</span>
                    <span ng-if="getInspectionCount() < campaign.numInspec && getInspectionCount() > 0" class="badge badge-warning">Em andamento</span>
                    <span ng-if="getInspectionCount() == 0" class="badge badge-default">Não iniciado</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Propriedades Customizadas -->
    <div ng-if="point.properties && hasCustomProperties()" class="detail-section">
        <h4 class="section-title">Propriedades Específicas</h4>
        <div class="info-grid">
            <div class="info-row" ng-repeat="(key, value) in point.properties" ng-if="shouldShowProperty(key)">
                <span class="info-label">{{ formatPropertyName(key) }}:</span>
                <span class="info-value">{{ value }}</span>
            </div>
        </div>
    </div>

    <!-- Estatísticas de Inspeção -->
    <div class="detail-section">
        <h4 class="section-title">Estatísticas de Inspeção</h4>
        <div class="stats-cards">
            <div class="stat-card-mini">
                <div class="value">{{ getInspectionCount() }}</div>
                <div class="label">Inspeções Realizadas</div>
            </div>
            <div class="stat-card-mini">
                <div class="value">{{ campaign.numInspec }}</div>
                <div class="label">Inspeções Necessárias</div>
            </div>
            <div class="stat-card-mini">
                <div class="value">{{ getUniqueInspectors() }}</div>
                <div class="label">Inspetores Únicos</div>
            </div>
            <div class="stat-card-mini">
                <div class="value">{{ getCompletionPercentage() }}%</div>
                <div class="label">Progresso</div>
            </div>
        </div>
    </div>

    <!-- Histórico de Inspeções -->
    <div ng-if="point.userName && point.userName.length > 0" class="detail-section">
        <h4 class="section-title">Histórico de Inspeções</h4>
        <table class="inspections-table">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Inspetor</th>
                    <th>Data</th>
                    <th>Tempo (s)</th>
                    <th>Classes de Uso</th>
                    <th>Pixel Borda</th>
                </tr>
            </thead>
            <tbody>
                <tr ng-repeat="inspection in getInspectionDetails() track by $index">
                    <td>{{ $index + 1 }}</td>
                    <td>
                        <span class="badge badge-default">{{ inspection.user }}</span>
                    </td>
                    <td>{{ inspection.date | date:'dd/MM/yyyy HH:mm' }}</td>
                    <td>{{ inspection.time || '-' }}</td>
                    <td>
                        <div class="class-tags" ng-if="inspection.landUseClasses && inspection.landUseClasses.length > 0">
                            <span ng-repeat="cls in inspection.landUseClasses" class="class-tag">
                                {{ cls }}
                            </span>
                        </div>
                        <span ng-if="!inspection.landUseClasses || inspection.landUseClasses.length == 0" style="color: #999;">-</span>
                    </td>
                    <td>
                        <div ng-if="inspection.pixelBorderInfo && inspection.pixelBorderInfo.length > 0">
                            <span ng-repeat="border in inspection.pixelBorderInfo" class="badge" 
                                  ng-class="border.value ? 'badge-warning' : 'badge-default'">
                                {{ border.value ? 'Sim' : 'Não' }}
                            </span>
                        </div>
                        <span ng-if="!inspection.pixelBorderInfo || inspection.pixelBorderInfo.length == 0" style="color: #999;">-</span>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Mensagem quando não há inspeções -->
    <div ng-if="!point.userName || point.userName.length == 0" class="detail-section">
        <div class="empty-message">
            <i class="glyphicon glyphicon-info-sign"></i>
            <p>Este ponto ainda não possui nenhuma inspeção realizada.</p>
        </div>
    </div>

    <!-- Limites Geográficos -->
    <div ng-if="point.bounds" class="detail-section">
        <h4 class="section-title">Limites Geográficos</h4>
        <div class="info-grid">
            <div class="info-group">
                <div class="info-row">
                    <span class="info-label">Norte:</span>
                    <span class="info-value monospace">{{ point.bounds.north | number:6 }}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Sul:</span>
                    <span class="info-value monospace">{{ point.bounds.south | number:6 }}</span>
                </div>
            </div>
            <div class="info-group">
                <div class="info-row">
                    <span class="info-label">Leste:</span>
                    <span class="info-value monospace">{{ point.bounds.east | number:6 }}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Oeste:</span>
                    <span class="info-value monospace">{{ point.bounds.west | number:6 }}</span>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal-footer">
    <button class="btn btn-primary" ng-click="viewInTemporal()">
        <i class="glyphicon glyphicon-eye-open"></i> Ver no Temporal
    </button>
    <button class="btn" ng-click="close()">Fechar</button>
</div>
